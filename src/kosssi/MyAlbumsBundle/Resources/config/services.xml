<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <!-- Form -->
        <parameter key="kosssi_my_albums.form.type.album_name.class">kosssi\MyAlbumsBundle\Form\Type\AlbumNameType</parameter>

        <!-- helper -->
        <parameter key="kosssi_my_albums.helper.image_cache.class">kosssi\MyAlbumsBundle\Helper\ImageCacheHelper</parameter>
        <parameter key="kosssi_my_albums.helper.image_rotate.class">kosssi\MyAlbumsBundle\Helper\ImageRotateHelper</parameter>

        <!-- listener -->
        <parameter key="kosssi_my_albums.listener.resolver.class">kosssi\MyAlbumsBundle\Entity\ListenerResolver</parameter>
        <parameter key="kosssi_my_albums.listener.image.class">kosssi\MyAlbumsBundle\Entity\ImageListener</parameter>
        <parameter key="kosssi_my_albums.listener.upload.class">kosssi\MyAlbumsBundle\EventListener\UploadListener</parameter>

        <!-- repository -->
        <parameter key="kosssi_my_albums.repository.album.class">kosssi\MyAlbumsBundle\Repository\AlbumRepository</parameter>
        <parameter key="kosssi_my_albums.repository.image.class">kosssi\MyAlbumsBundle\Repository\ImageRepository</parameter>
    </parameters>

    <services>
        <!-- Form -->
        <service id="kosssi_my_albums.form.type.album_name" class="%kosssi_my_albums.form.type.album_name.class%">
            <tag name="form.type" alias="album_name" />
        </service>

        <!-- helper -->
        <service id="kosssi_my_albums.helper.image_cache" class="%kosssi_my_albums.helper.image_cache.class%">
            <argument type="service" id="filesystem" />
            <argument type="service" id="liip_imagine.cache.manager" />
        </service>
        <service id="kosssi_my_albums.helper.image_rotate" class="%kosssi_my_albums.helper.image_rotate.class%">
            <argument type="service" id="liip_imagine" />
            <argument type="service" id="liip_imagine.cache.manager" />
        </service>

        <!-- listener -->
        <service id="kosssi_my_albums.listener.resolver" class="%kosssi_my_albums.listener.resolver.class%">
            <argument type="service" id="service_container"/>
        </service>
        <service id="kosssi_my_albums.listener.image" class="%kosssi_my_albums.listener.image.class%">
            <argument type="service" id="liip_imagine.cache.manager"/>
            <argument type="service" id="filesystem"/>
        </service>
        <service id="kosssi_my_albums.listener.upload" class="%kosssi_my_albums.listener.upload.class%">
            <argument type="service" id="doctrine.orm.entity_manager" />
            <argument type="service" id="kosssi_my_albums.repository.image" />
            <argument type="service" id="kosssi_my_albums.helper.image_rotate" />
            <tag name="kernel.event_listener" event="oneup_uploader.post_persist" method="onUpload" />
        </service>

        <!-- repository -->
        <service id="kosssi_my_albums.repository.album" class="%kosssi_my_albums.repository.album.class%"
                 factory-service="doctrine.orm.entity_manager"
                 factory-method="getRepository"
                >
            <argument>kosssiMyAlbumsBundle:Album</argument>
        </service>
        <service id="kosssi_my_albums.repository.image" class="%kosssi_my_albums.repository.image.class%"
                 factory-service="doctrine.orm.entity_manager"
                 factory-method="getRepository"
                >
            <argument>kosssiMyAlbumsBundle:Image</argument>
        </service>
    </services>
</container>
