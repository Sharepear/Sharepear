<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <!-- helper -->
        <parameter key="kosssi_my_albums.helper.image.class">kosssi\MyAlbumsBundle\Helper\ImageHelper</parameter>

        <!-- listener -->
        <!--<parameter key="kosssi_my_albums.listener.resolver.class">kosssi\MyAlbumsBundle\EntityListener\ListenerResolver</parameter>-->
        <parameter key="kosssi_my_albums.listener.upload.class">kosssi\MyAlbumsBundle\EventListener\UploadListener</parameter>

        <!-- repository -->
        <parameter key="kosssi_my_albums.repository.album.class">kosssi\MyAlbumsBundle\Repository\AlbumRepository</parameter>
        <parameter key="kosssi_my_albums.repository.image.class">kosssi\MyAlbumsBundle\Repository\ImageRepository</parameter>
    </parameters>

    <services>
        <!-- helper -->
        <service id="kosssi_my_albums.helper.image" class="%kosssi_my_albums.helper.image.class%">
            <argument type="service" id="liip_imagine" />
            <argument type="service" id="liip_imagine.controller" />
            <call method="setRequest">
                <argument type="service" id="request_stack" />
            </call>
        </service>

        <!-- listener -->
        <!--<service id="kosssi_my_albums.listener.resolver" class="kosssi_my_albums.listener.resolver.class">-->
        <!--</service>-->
        <service id="kosssi_my_albums.listener.upload" class="%kosssi_my_albums.listener.upload.class%">
            <argument type="service" id="doctrine.orm.entity_manager" />
            <argument type="service" id="kosssi_my_albums.repository.album" />
            <argument type="service" id="kosssi_my_albums.helper.image" />
            <tag name="kernel.event_listener" event="oneup_uploader.post_persist" method="onUpload" />
        </service>

        <!-- repository -->
        <service id="kosssi_my_albums.repository.album" class="%kosssi_my_albums.repository.album.class%"
                 factory-service="doctrine.orm.entity_manager"
                 factory-method="getRepository"
                >
            <argument>kosssiMyAlbumsBundle:Album</argument>
        </service>
        <service id="kosssi_my_albums.repository.image" class="%kosssi_my_albums.repository.image.class%"
                 factory-service="doctrine.orm.entity_manager"
                 factory-method="getRepository"
                >
            <argument>kosssiMyAlbumsBundle:Image</argument>
        </service>
    </services>
</container>
